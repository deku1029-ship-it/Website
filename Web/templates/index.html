<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω c√¥ng vi·ªác</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }
        .dark-mode .form-control,
        .dark-mode .form-select {
            background-color: #2c2c2c;
            color: #e0e0e0;
            border-color: #444;
        }
        .dark-mode .list-group-item {
            background-color: #1f1f1f;
            color: #e0e0e0;
            border-color: #444;
        }
    </style>
</head>
<body class="container py-4">

    <!-- N√∫t chuy·ªÉn ch·∫ø ƒë·ªô n·ªÅn -->
    <div class="d-flex justify-content-end mb-2">
        <button id="toggleDarkMode" class="btn btn-sm btn-outline-dark">üåô Ch·∫ø ƒë·ªô t·ªëi</button>
    </div>

    <!-- Th√¥ng tin ƒëƒÉng nh·∫≠p -->
    <div class="mb-3">
        {% if 'username' in session %}
            <p>Xin ch√†o, <strong>{{ session['username'] }}</strong>!
                <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-danger ms-2">ƒêƒÉng xu·∫•t</a>
            </p>
        {% else %}
            <a href="{{ url_for('login') }}" class="btn btn-sm btn-primary">ƒêƒÉng nh·∫≠p</a>
            <a href="{{ url_for('register') }}" class="btn btn-sm btn-secondary ms-2">ƒêƒÉng k√Ω</a>
        {% endif %}
    </div>

    <h1 class="mb-4">üìã Danh s√°ch c√¥ng vi·ªác</h1>

    <!-- L·ªçc v√† t√¨m ki·∫øm -->
    <form class="row g-2 mb-4" method="get" action="/">
        <div class="col-md-3">
            <input type="date" name="date_filter" value="{{ request.args.get('date_filter', '') }}" class="form-control">
        </div>
        <div class="col-md-3">
            <input type="text" name="search" placeholder="T√¨m ki·∫øm..." value="{{ request.args.get('search', '') }}" class="form-control">
        </div>
        <div class="col-md-3">
            <select name="status_filter" class="form-select">
                <option value="">-- Tr·∫°ng th√°i --</option>
                <option value="Ch∆∞a ho√†n th√†nh" {% if request.args.get('status_filter') == 'Ch∆∞a ho√†n th√†nh' %}selected{% endif %}>Ch∆∞a ho√†n th√†nh</option>
                <option value="ƒêang l√†m" {% if request.args.get('status_filter') == 'ƒêang l√†m' %}selected{% endif %}>ƒêang l√†m</option>
                <option value="Ho√†n th√†nh" {% if request.args.get('status_filter') == 'Ho√†n th√†nh' %}selected{% endif %}>Ho√†n th√†nh</option>
            </select>
        </div>
        <div class="col-md-3 d-flex">
            <button type="submit" class="btn btn-success me-2">L·ªçc</button>
            <a href="/" class="btn btn-outline-secondary">X√≥a l·ªçc</a>
        </div>
    </form>

    <!-- Th√™m c√¥ng vi·ªác -->
    <form action="/add" method="post" class="row g-2 mb-5">
        <div class="col-md-3">
            <input type="text" name="title" placeholder="Ti√™u ƒë·ªÅ" required class="form-control">
        </div>
        <div class="col-md-3">
            <input type="text" name="description" placeholder="M√¥ t·∫£" required class="form-control">
        </div>
        <div class="col-md-2">
            <input type="date" name="due_date" required class="form-control">
        </div>
        <div class="col-md-2">
            <input type="text" name="label" placeholder="Nh√£n (v√≠ d·ª•: G·∫•p)" required class="form-control">
        </div>
        <div class="col-md-2">
            <select name="category" required class="form-select">
                <option value="">-- Ph√¢n lo·∫°i --</option>
                <option value="C√° nh√¢n">C√° nh√¢n</option>
                <option value="C√¥ng vi·ªác">C√¥ng vi·ªác</option>
                <option value="H·ªçc t·∫≠p">H·ªçc t·∫≠p</option>
                <option value="Kh√°c">Kh√°c</option>
            </select>
        </div>
        <div class="col-md-2">
            <select name="status" required class="form-select">
                <option value="Ch∆∞a ho√†n th√†nh">Ch∆∞a ho√†n th√†nh</option>
                <option value="ƒêang l√†m">ƒêang l√†m</option>
                <option value="Ho√†n th√†nh">Ho√†n th√†nh</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Th√™m</button>
        </div>
    </form>

    <!-- Danh s√°ch c√¥ng vi·ªác -->
    <ul class="list-group">
        {% for task in tasks %}
        <li class="list-group-item">
            <strong>{{ task[1] }}</strong> ‚Äî {{ task[2] }}
            {% if task[3] %} <span class="badge bg-warning text-dark">üìÖ {{ task[3] }}</span> {% endif %}
            {% if task[4] %} <span class="badge bg-info text-dark">üè∑Ô∏è {{ task[4] }}</span> {% endif %}
            {% if task[5] %} <span class="badge bg-secondary">{{ task[5] }}</span> {% endif %}
            {% if task[6] %} <span class="badge bg-success">{{ task[6] }}</span> {% endif %}
            <a href="/edit/{{ task[0] }}" class="btn btn-sm btn-outline-primary ms-2">S·ª≠a</a>
            <a href="/delete/{{ task[0] }}" class="btn btn-sm btn-outline-danger">X√≥a</a>
        </li>
        {% endfor %}
    </ul>

    <!-- Script Dark Mode -->
    <script>
        const body = document.body;
        const toggleBtn = document.getElementById('toggleDarkMode');
        const currentMode = localStorage.getItem('mode');

        if (currentMode === 'dark') {
            body.classList.add('dark-mode');
            toggleBtn.textContent = '‚òÄÔ∏è Ch·∫ø ƒë·ªô s√°ng';
        }

        toggleBtn.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            const isDark = body.classList.contains('dark-mode');
            toggleBtn.textContent = isDark ? '‚òÄÔ∏è Ch·∫ø ƒë·ªô s√°ng' : 'üåô Ch·∫ø ƒë·ªô t·ªëi';
            localStorage.setItem('mode', isDark ? 'dark' : 'light');
        });
    </script>

</body>
</html>
